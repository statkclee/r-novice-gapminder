---
layout: page
title: 재현가능한 과학적 분석을 위한 R
subtitle: R과 RStudio 소개
minutes: 45
---

```{r, include=FALSE}
source("tools/chunk-options.R")
```

> ## 학습 목표 {.objectives}
>
> * RStudio IDE 개발환경에 나온 다양한 창에 친숙해진다.
> * RStudio IDE 개발환경에 활용되는 버튼, 단축키, 선택옵션과 친숙해진다.
> * 변수를 이해하고, 변수에 값을 할당하는 방법을 이해한다.
> * 인터랙티브 R 세션에 작업공간을 관리할 수 있다.
> * 수학 연산과 비교연산 작업을 수행할 수 있다.
> * 함수를 호출할 수 있다.
> * 팩키지 관리에 대한 소개
> 

## RStudio 소개

소프트웨어 카펜트리 R교육에 오신 것을 환영합니다.

이번 R 수업시간을 통해서, R 언어 기본기 뿐만 아니라 저녁이 있는 삶을 가능토록
과학 프로젝트에 코드를 구조화하는 모범 활용사례도 교육한다.

도구로 RStudio 를 사용한다: 자유로이 사용가능하고, 무료이며, 오픈 소스
R과 통합된 개발 환경을 제공한다.
RStudio는 편집기가 내장되어 있고, (서버 포함) 모든 플랫폼에서 동작하고,
버젼 제어 및 프로젝트 관리 같은 많은 앞선 기능을 제공한다.

**기본 배치**

RStudio를 처음 열게 되면, 창 3개가 반갑게 여러분을 맞이한다:

  * 인터랙티브 R 콘솔 : 좌측 전체
  * 작업공간(Workspace)/이력 (History) : 우측상단 탭
  * 파일(File)/그래프(Plot)/팩키지(Package)/도움말(Help): 우측하단 탭

R 스크립트 같은 파일을 열게 되면, 편집창이 좌측 상단에 열린다.

## RStudio 내부 작업흐름

RStudio 내부에서 작업하는 방식이 크게 두가지 있다.

1. 인터랙티브 R 콘솔에서 테스트하고 가지고 놀다가, 나중에 실행할 `.R` 파일에 복사해서 붙여넣는다.
   *  초기 시작하고 작은 테스트를 할 때 잘 작동한다.
   * 신속하게 노동 집약적인 개발이 된다.
2. `.R` 파일에서 작업을 시작하고, RStudio 명령어/단축키를 사용해서 
현재 라인, 선택된 라인 혹은 변경된 라인을 인터랙티브 R 콘솔에 밀어넣어 실행한다.
   * 시작하는 매우 훌륭한 방식이다; 작성된 모든 코드가 나중에 저장된다.
   * RStudio 내부 혹은 R `source()` 함수를 사용해서 생성한 파일을 실행할 수 있다.

> ## Tip: 코드 일부 실행하기 {.callout}
>
> 편집기 창에서 코드를 실행하는데 있어 상당한 유연성을 RStudio가 제공한다.
> 버튼, 메뉴, 키보드 단축키, 세가지 방식이 있다.
> 현재 라인을 실행하려면,
> 
> 1. 편집기창 상단 `Run` 버튼을 클릭한다.
> 2. "Code" 메뉴에서 "Run Lines" 를 선택한다.
> 3. 리눅스 혹은 윈도우에서 `Ctrl+엔터`, 맥 OS X에서 `Command+엔터` 단축키를 누른다.
> (단축키는 버튼 위에 마우스를 올리면 볼 수 있다).
> 
> 코드 블록을 실행하려면, 코드 블록을 선택하고 나서, `Run` 버튼을 누른다.
> 방금전에 실행한 코드 블록 내부 일부 코드를 변경했다면,
> 다시 코드 블록을 선택하고, `Run` 버튼을 누를 필요가 없다.
> 바로 옆에 있는 버튼(`Re-run the previous region`)을 누르면 된다.
> 이 버튼은 방금전에 변경한 내용을 포함해서 이전 코드 블록을 실행시킨다.

## R 소개

R에서 상당한 시간을 R 인터랙티브 콘솔에서 사용한다.
이곳이 여러분이 작성한 모든 코드를 실행하는 곳으로
R 스크립트 파일에 추가하기 전에, 아이디어를 시험하는 유용한 환경이다.
RStudio 콘솔은 `R` 명령-라인 환경에서 입력하는 곳과 동일하다.

R 인터랙티브 세션에서 보게 되는 첫번째 사항은 정보가 쭉 나오고 나서,
">" 가 나타나고 커서가 깜빡인다.
여러가지 면에서, 쉘 수업시간에 학습한 쉘 환경과 유사하다:
**REPL** 루프(읽고, 평가하고, 출력하는 루프) 기본 아이디어 위에서 동작한다.
명령어를 입력하면, R이 명령어를 실행하고 나서, 결과를 반환한다.

## 계산기로 R 사용하기

R로 할 수 있는 가장 간단한 것이 산수다:

```{r}
1 + 100
```

R이 "[1]" 다음에 정답을 출력한다.
지금 당장 "[1]"에 대해 걱정하지 말자. 나중에 설명이 나와 있다.
지금은 일단 출력결과를 지칭한다고 생각한다.

배쉬(bash) 처럼, 불완전한 명령어를 타이핑하면, R은 사용자가 명령어를 완성할 때까지 대기한다:

~~~ {.r}
> 1 +
~~~

~~~ {.output}
+
~~~

`1+` 다음에 `엔터`를 치게되면, R 세션이 ">" 대신에 "+" 을 보여준다.
이것이 의미하는 바는 명령어가 완성될 때까지 대기한다는 것이다.
명령어를 취소하고자 한다면, 단순히 "Esc" 키를 치게 되면, 다시 ">" 프롬프트로 되돌아 간다.

> ## Tip: 명령문 취소 {.callout}
>
> RStudio가 아니고 R 명령-라인을 사용하고 있다면, 명령문을 취소하는데 
> `ESC` 대신에 `Ctrl+C` 사용이 필요하다.
> 또한, 이런 사실은 맥 사용자에도 동일하게 적용된다!
>
> 명령어 취소는 불완성된 명령어를 종료시키는데 그다지 유용하지는 않다:
> 명령어 취소 기능을 실행되고 있는 코드를 멈추는데도 사용할 수 있다.
> (예를 들어, 예상한 것보다 훨씬 더 오래 시간이 소요되는 경우)
> 혹은 현재 작성하고 있는 코드를 제거할 때도 사용한다.
>

계산기로 R을 사용할 때, 연산 순위는 초중등학교에서 배운 것과 동일하다.

가장 우선순위가 높은 것부터 낮은 순서는 다음과 같다:

 * 괄호: `(`, `)`
 * 멱승: `^` or `**`
 * 나눗셈: `/`
 * 곱셈: `*`
 * 덧셈: `+`
 * 뺄셈: `-`

```{r}
3 + 5 * 2
```

괄호를 사용해서 연산작업을 한데 묶는데, 
이유는 의도한 바를 명확히 하거나, 기본설정과 차이가 날 때 평가순서를 강제하기 위해서다.

```{r}
(3 + 5) * 2
```

꼭 필요하지 않을 때 괄호가 사용되면 읽기 힘들어 지기도 하지만,
의도를 명확히 한다.
나중에 여러분이 작성한 코드를 다른 사람이 읽게 됨을 기억하라.

```{r, eval=FALSE}
(3 + (5 * (2 ^ 2))) # 읽기 어렵다.
3 + 5 * 2 ^ 2       # 만약 수학 연산 우선순위 규칙을 기억한다면, 명확한다.
3 + 5 * (2 ^ 2)     # 우선순위 규칙을 잊어버린 경우, 도움이 된다.
```

상기 코드 각 라인 뒤에 텍스트를 "주석"이라고 부른다.
해쉬(혹은 번호기호)기호 `#` 다음에 오는 모든 것은 코드가 실행될 때 R에서 무시된다.

매우 작거나 큰 숫자는 과학 표기법을 따른다:

```{r}
2/10000
```

상기 표기법은 `10^XX` 곱한 것을 축약한 것이다.
따라서, `2e-4`은 `2 * 10^(-4)`을 축약한 것이다.

숫자를 과학 표기법으로 작성할 수도 있다:

```{r}
5e3  # 양수는 음의 부호가 생략됨에 주의
```

## 수학 함수

R has many built in mathematical functions. To call a function,
we simply type its name, followed by  open and closing parentheses.
Anything we type inside the parentheses is called the function's
arguments:

```{r}
sin(1)  # trigonometry functions
```

```{r}
log(1)  # natural logarithm
```

```{r}
log10(10) # base-10 logarithm
```

```{r}
exp(0.5) # e^(1/2)
```

Don't worry about trying to remember every function in R. You
can simply look them up on google, or if you can remember the
start of the function's name, use the tab completion in RStudio.

This is one advantage that RStudio has over R on its own, it
has autocompletion abilities that allow you to more easily
look up functions, their arguments, and the values that they
take.

Typing a `?` before the name of a command will open the help page
for that command. As well as providing a detailed description of
the command and how it works, scrolling ot the bottom of the
help page will usually show a collection of code examples which
illustrate command usage. We'll go through an example later.

## Comparing things

We can also do comparison in R:

```{r}
1 == 1  # equality (note two equals signs, read as "is equal to")
```

```{r}
1 != 2  # inequality (read as "is not equal to")
```

```{r}
1 <  2  # less than
```

```{r}
1 <= 1  # less than or equal to
```

```{r}
1 > 0  # greater than
```

```{r}
1 >= -9 # greater than or equal to
```

> ## Tip: Comparing Numbers {.callout}
>
> A word of warning about comparing numbers: you should
> never use `==` to compare two numbers unless they are
> integers (a data type which can specifically represent
> only whole numbers).
>
> Computers may only represent decimal numbers with a
> certain degree of precision, so two numbers which look
> the same when printed out by R, may actually have
> different underlying representations and therefore be
> different by a small margin of error (called Machine
> numeric tolerance).
>
> Instead you should use the `all.equal` function.
>
> Further reading: [http://floating-point-gui.de/](http://floating-point-gui.de/)
>

## Variables and assignment

We can store values in variables using the assignment operator `<-`, like this:

```{r}
x <- 1/40
```

Notice that assignment does not print a value. Instead, we stored it for later
in something called a **variable**. `x` now contains the **value** `0.025`:

```{r}
x
```

More precisely, the stored value is a *decimal approximation* of
this fraction called a [floating point number](http://en.wikipedia.org/wiki/Floating_point).

Look for the `Environment` tab in one of the panes of RStudio, and you will see that `x` and its value
have appeared. Our variable `x` can be used in place of a number in any calculation that expects a number:

```{r}
log(x)
```

Notice also that variables can be reassigned:

```{r}
x <- 100
```

`x` used to contain the value 0.025 and and now it has the value 100.

Assignment values can contain the variable being assigned to:

```{r}
x <- x + 1 #notice how RStudio updates its description of x on the top right tab
```

The right hand side of the assignment can be any valid R expression.
The right hand side is *fully evaluated* before the assignment occurs.

Variable names can contain letters, numbers, underscores and periods. They
cannot start with a number nor contain spaces at all. Different people use
different conventions for long variable names, these include

  * periods.between.words
  * underscores\_between_words
  * camelCaseToSeparateWords

What you use is up to you, but **be consistent**.

It is also possible to use the `=` operator for assignment:

```{r}
x = 1/40
```

But this is much less common among R users.  The most important thing is to
**be consistent** with the operator you use. There are occasionally places
where it is less confusing to use `<-` than `=`, and it is the most common
symbol used in the community. So the recommendation is to use `<-`.

## Vectorization

One final thing to be aware of is that R is *vectorized*, meaning that
variables and functions can have vectors as values. For example

```{r}
1:5
2^(1:5)
x <- 1:5
2^x
```

This is incredibly powerful; we will discuss this further in an
upcoming lesson.


## Managing your environment

There are a few useful commands you can use to interact with the R session.

`ls` will list all of the variables and functions stored in the global environment
(your working R session):

```{r}
ls()
```

> ## Tip: hidden objects {.callout}
>
> Just like in the shell, `ls` will hide any variables or functions starting
> with a "." by default. To list all objects, type `ls(all.names=TRUE)`
> instead
>

Note here that we didn't given any arguments to `ls`, but we still
needed to give the parentheses to tell R to call the function.

If we type `ls` by itself, R will print out the source code for that function!

```{r}
ls
```

You can use `rm` to delete objects you no longer need:

```{r}
rm(x)
```

If you have lots of things in your environment and want to delete all of them,
you can pass the results of `ls` to the `rm` function:

```{r}
rm(list = ls())
```

In this case we've combined the two. Just like the order of operations, anything
inside the innermost parentheses is evaluated first, and so on.

In this case we've specified that the results of `ls` should be used for the
`list` argument in `rm`. When assigning values to arguments by name, you *must*
use the `=` operator!!

If instead we use `<-`, there will be unintended side effects, or you may just
get an error message:

```{r, error=TRUE}
rm(list <- ls())
```

> ## Tip: Warnings vs. Errors {.callout}
>
> Pay attention when R does something unexpected! Errors, like above,
> are thrown when R cannot proceed with a calculation. Warnings on the
> other hand usually mean that the function has run, but it probably
> hasn't worked as expected.
>
> In both cases, the message that R prints out usually give you clues
> how to fix a problem.
>


## R Packages

It is possible to add functions to R by writing a package, or by
obtaining a package written by someone else. As of this writing, there
are over 7,000 packages available on CRAN (the comprehensive R archive
network). R and RStudio have functionality for managing packages:

* You can see what packages are installed by typing
  `installed.packages()`
* You can install packages by typing `install.packages("packagename")`,
  where `packagename` is the package name, in quotes.
* You can update installed packages by typing `update.packages()`
* You can remove a package with `remove.packages("packagename")`
* You can make a package available for use with `library(packagename)`


> ## Challenge 1 {.challenge}
>
> What will be the value of each  variable  after each
> statement in the following program?
>
> ```{r, eval=FALSE}
> mass <- 47.5
> age <- 122
> mass <- mass * 2.3
> age <- age - 20
> ```
>

> ## Challenge 2 {.challenge}
>
> Run the code from the previous challenge, and write a command to
> compare mass to age. Is mass larger than age?
>

> ## Challenge 3 {.challenge}
>
> Clean up your working environment by deleting the mass and age
> variables.
>

> ## Challenge 4 {.challenge}
> 
> Install the following packages: `ggplot2`, `plyr`, `gapminder`
> 
